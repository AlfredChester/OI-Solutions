# 【模板】线段树 3（区间最值操作、区间历史最值） 题解

[传送门: https://www.luogu.com.cn/problem/P6242](https://www.luogu.com.cn/problem/P6242)

## 题意

写一个数据结构，维护以下几种操作：

1. 区间加 $k$；
2. 区间赋值为最小值，即 $\forall i \in [l, r]$，将 $A_i \leftarrow \min(A_i, v)$；
3. 求区间和；
4. 求区间最大值；
5. 求区间历史出现过的最大值中的最大值。

## 分析思路

本题解中的概念，算法，数据结构大量参考了国家集训队论文《区间最值与历史最值问题》^[[国家集训队2016论文集 区间最值与历史最值问题 杭州学军中学 吉如一](https://github.com/enkerewpo/OI-Public-Library/blob/master/IOI%E4%B8%AD%E5%9B%BD%E5%9B%BD%E5%AE%B6%E5%80%99%E9%80%89%E9%98%9F%E8%AE%BA%E6%96%87/%E5%9B%BD%E5%AE%B6%E9%9B%86%E8%AE%AD%E9%98%9F2016%E8%AE%BA%E6%96%87%E9%9B%86.pdf#page=103)]，谨在此对该论文的作者吉如一同学表达由衷的感谢和敬佩。

本题是吉司机线段树的模板题，值得经常复习。

由于进行区间最值操作，传统的懒标记策略无法快速更新区间和，所以需要进一步的创新。

考虑在线段树上除了维护区间和 $sum$ 以外，还要维护区间中的最大值 $mx$，**严格次大值** $se$ 和最大值个数 $t$。



## 代码

```cpp
```