# [复习资料]概率期望学习笔记



<div class="toc"><div class="toc-container-header">目录</div><ul><li><a href="#概率期望学习笔记" rel="noopener nofollow">概率期望学习笔记</a><ul><li><a href="#基础概念" rel="noopener nofollow">基础概念</a><ul><li><a href="#事件" rel="noopener nofollow">事件</a></li><li><a href="#概率" rel="noopener nofollow">概率</a><ul><li><a href="#全概率公式" rel="noopener nofollow">全概率公式</a></li><li><a href="#贝叶斯公式" rel="noopener nofollow">贝叶斯公式</a></li></ul></li><li><a href="#期望" rel="noopener nofollow">期望</a></li></ul></li><li><a href="#简单应用" rel="noopener nofollow">简单应用</a><ul><li><a href="#经典问题" rel="noopener nofollow">经典问题</a></li><li><a href="#简单期望练习题" rel="noopener nofollow">简单期望练习题</a></li></ul></li><li><a href="#小结" rel="noopener nofollow">小结</a></li></ul></li></ul></div>


<h1 id="概率期望学习笔记">概率期望学习笔记</h1>

<h2 id="基础概念">基础概念</h2>

<h3 id="事件">事件</h3>

互斥事件： 如果事件 $A$ 和事件 $B$ 无法同时发生，那么 $A$ 和 $B$ 是互斥事件。

对立事件：如果事件 $A$ 和事件 $B$ 无法同时发生，并且要么 $A$ 发生，要么 $B$ 发生，那么 $A$ 和 $B$ 是对立事件。

相互独立事件：如果事件 $A$ 和事件 $B$ 之间互不影响（即 $A$ 发不发生和 $B$ 发不发生无关），那么 $A$ 和 $B$ 是相互独立事件。

<h3 id="概率">概率</h3>

概率是反映随机事件出现的可能性大小，随机事件是指在相同条件下，可能出现也可能不出现的事件。

<ul>
<li>$P(A)$ 表示事件 $A$ 发生的概率。</li>
<li>$P(A-B)$ 表示事件 $A$ 发生并且事件 $B$ 不发生的概率。</li>
<li>$P(A+B)$ 表示事件 $A$ 发生或者事件 $B$ 发生的概率。</li>
<li>$P(AB)$ 表示事件 $A$ 发生并且事件 $B$ 发生的概率。</li>
<li>$P(A\mid B)$ 表示事件 $A$ 在事件 $B$ 已经发生的条件下发生的概率。</li>
</ul>

<h4 id="全概率公式">全概率公式</h4>

如果 $B_1,B_2,\dots,B_n$ 互斥，并且 $\cup_{i=1}^nB_i$ 是全集（样本空间），那么：


$$
P(A)=\sum_{i=1}^nP(A\mid B_i)\times P(B_i)

$$

<h4 id="贝叶斯公式">贝叶斯公式</h4>

如果 $B_1,B_2,\dots,B_n$ 互斥，并且 $\cup_{i=1}^nB_i$ 是全集（样本空间），那么：


$$
P(A\mid B_i)P(B_i)=P(B_i\mid A)P(A)=P(AB)

$$

由此可以得到：


$$
P(B_i\mid A)=\frac{P(A\mid B_i)P(B_i)}{P(A)}=\frac{P(A\mid B_i)P(B_i)}{\sum_{j=1}^nP(A\mid B_j)P(B_j)}

$$

<h3 id="期望">期望</h3>

期望是每次结果乘以其概率之和，它反映的是随机变量平均取值的大小。

$E(X)$ 表示变量 $X$ 的期望。

设 $X,Y$ 是两个随机变量， $C$ 是一个常数，那么：

<ul>
<li>$E(C)=C$ 。</li>
<li>$E(CX)=C\cdot E(X)$ 。</li>
<li>$E(X+Y)=E(X)+E(Y)$ 。</li>
<li>如果 $X$ 和 $Y$ 相互独立，那么 $E(XY)=E(X)E(Y)$ 。</li>
</ul>

如果事件 $X$ 发生的概率都是是 $p$ ，那么事件 $X$ 期望 $\frac{1}{p}$ 次发生，因为 $E(X)=\sum_{i=1}^{\infty}P(X\ge i)=\sum_{i=1}^{\infty}(1-p)^{i-1}=\frac{1}{1-(1-p)}=\frac{1}{p}$ 。

<h2 id="简单应用">简单应用</h2>

下面的题目不考虑复杂度等问题，重点在思维。

期望的线性性是一个很重要的性质，要学会使用。

<h3 id="经典问题">经典问题</h3>

<ol>
<li>每次随机一个 $[1,n]$ 的整数，期望几次集齐所有数？</li>
<li>随机一个长度为 $n$ 的排列 $p$ ，求 $p_i=\max_{j=1}^ip_j$ 的概率。</li>
<li>随机一个长度为 $n$ 的排列 $p$ ，求满足 $p_i=\max_{j=1}^ip_j$ 的 $i$ 的个数的平方的期望。</li>
<li>随机一个长度为 $n$ 的排列 $p$ ，求 $i$ 在 $j$ 后面的概率。</li>
<li>随机一个长度为 $n$ 的排列 $p$ ，求这个排列包含 $w_1,w_2,\dots,w_m$ 作为子序列的概率。</li>
<li>随机一个长度为 $n$ 的排列 $p$ ，求这个排列包含 $w_1,w_2,\dots,w_m$ 作为连续子序列的概率。</li>
<li>有 $n$ 堆石子，第 $i$ 堆个数为 $a_i$ ，每次随机选一个石头然后扔掉这个石子在的整堆石子，求第 $1$ 堆石头期望第几次被扔。</li>
<li>随机一个长度为 $n$ 的 01 串，每个位置是 $1$ 的概率是 $p$ ，定义 X 是每段连续为 $1$ 的长度平方之和，求 $E(X)$ 。</li>
<li>给定一个排列，每次随机删除一个元素，问 $i$ 和 $j$ 在整个过程中存在一次相邻的概率。</li>
<li>给定一棵树，将它的边随机顺序依次插入，求 $u,v$ 期望何时连通。</li>
<li>给定 $1\sim n$ 这些数，每次随机一个还在的数并且删除它和它的所有约数，期望何时删完？</li>
</ol>

答案在下面。

<ol>
<li>如果已经集齐了 $x$ 个不同的数，那么再集齐一个不同的数的概率是 $\frac{n-x}{n}$ ，期望 $\frac{n}{n-x}$ 次后集齐，答案就是 $\sum_{x=0}^{n-1}\frac{n}{n-x}$ 。</li>
<li>考虑如何构造一个长度为 $n$ 的排列，可以从左到右依次插入数，由此可以看出概率为 $\frac{1}{i}$ 。</li>
<li>平方也可以理解为从满足条件中的数中选一个再选一个的期望，设 $X_i$ 表示 $p_i=\max_{j=1}^ip_j$ 这个事件，那么 $P(X_i)=\frac{1}{i}$ ，从上题可以看出 $X_i,X_j(i\ne j)$ 彼此独立，所以 $P(X_iX_j)$ 当 $i=j$ 时等于 $\frac{1}{i}$ ，否则为 $\frac{1}{ij}$ ，答案就是 $\sum_{i=1}^n\sum_{j=1}^nP(X_iX_j)$ 。</li>
<li>$i$ 要么在 $j$ 前面，要么在 $j$ 后面，可以看出这两个等价，所以答案就是 $\frac{1}{2}$ 。</li>
<li>$w_1,w_2,\dots,w_m$ 在排列中出现顺序的方案共有 $m!$ 种，答案就是 $\frac{1}{m!}$ 。</li>
<li>统计合法方案数除以总数，枚举出现位置，答案是 $\frac{1}{n!}(n-m+1)!$ 。</li>
<li>设 $P(i)$ 表示第 $i$ 堆石子在第 $1$ 堆石子之前扔掉的概率，在仅考虑 $i$ 和 $1$ 的时候不需要考虑其他东西，所以 $P(i)=\frac{a_i}{a_i+a_1}$ ，答案就是 $1+\sum_{i=2}^nP(i)$ 。</li>
<li>一样的，平方可以理解为先选一个再选一个，所以答案就是 $\sum_{i=1}^n\sum_{j=1}^np^{\mid i-j\mid +1}$ 。</li>
<li>不妨假设 $j>i$ ，相当于要求 $(i,j)$ 中的所有数要比 $i,j$ 先删除， $[i,j]$ 中所有数先后顺序共有 $(j-i+1)!$ 种可能，其中 $i,j$ 在最后面共有 $2\times (j-i-1)!$ 可能，答案为 $\frac{2}{(j-i)(j-i+1)}$ 。</li>
<li>设 $u,v$ 之间的边数为 $s$ ， $E(X)=\sum_{i=1}^{n-1}P(X\ge i)=\sum_{i=1}^{n-1}(1-{i-1\choose s}/{n-1\choose s})$ 。</li>
<li>设 $P(i)$ 表示 $i$ 是在随机到 $i$ 而不是 $i$ 的倍数时删除的， $i$ 的倍数共有 $\lfloor\frac{n}{i}\rfloor$ 个，所以 $P(i)=\frac{1}{\lfloor\frac{n}{i}\rfloor}$，那么答案就是 $\sum_{i=1}^nP(i)$ 。</li>
</ol>

<h3 id="简单期望练习题">简单期望练习题</h3>

<ol>
<li>给定 $n$ 个硬币，第 $i$ 个硬币的价值为 $w_i$ ，每次随机取走一个硬币，获得的收益时左右两个硬币的价值之积，求期望总价值。</li>
<li>$n$ 个数 $\{a\}$ ，等概率选两个数，获得的收益时两个数之和，然后删除这两个数，把它们之和加入回去，求收益的期望。</li>
<li>$n$ 个数 $\{w\}$ ，随机一个排列 $\{h\}$ ，如果 $2\le i\le n-1,h_i>\max(h_{i-1},h_{i+1})$ ，那么获得 $w_i$ 的收益，求收益的期望。</li>
<li>一棵树，每次选一个白点的然后染黑以这个点为根的整棵子树，求期望几次染黑整棵树。</li>
<li>$n$ 个黑球， $m$ 个白球，每次等概率取出一个球，不放回，将取出来的球的颜色写成一个 01 序列，求“01”（“0”后面紧接着一个“1”）的期望出现次数。</li>
<li>$n$ 个点的树，第 $i$ 个点有 $p_i$ 的概率被删除，求期望连通块数量。</li>
<li>$n$ 个点的树，从 $1$ 号点开始 dfs ，每次遍历儿子节点时都是将所有儿子按随机顺序遍历，求每个点 dfs 序的期望。</li>
<li>$n$ 个数，每个数都是从 $[1,m]$ 中等概率随机得到的一个整数，求所有数最大值的期望。</li>
</ol>

答案在下面：

<ol>
<li>设 $p_{i,j}(i+1<j)$ 表示 $i,j$ 是 $[i,j]$ 中最后一个删除的，那么答案就是 $\sum_{i=1}^{n}\sum_{j=i+2}^{n}p_{i,j}\times w_i\times w_j$ ，如何求 $p$ 上面已经写过了。</li>
<li>设 $p_i$ 表示还剩 $i$ 个数，这次选择两个数进行删除操作中包含第 $1$ 个数的概率，那么 $p_i=\frac{{i-1\choose 2}}{{i\choose 2}}$ ，由此可以得出每个数对答案进行贡献时乘以的系数 $E=\sum_{i=2}^{n}p_i$ ，答案就是 $E\times \sum_{i=1}^na_i$ 。</li>
<li>相邻三个数 $h_{i-1},h_i,h_{i+1}$ 的大小关系是等概率的，所以 $h_i>\max(h_{i-1},h_{i+1})$ 的概率就是 $\frac{1}{3}$ ，答案就是 $\frac{1}{3} \sum_{i=2}^{n-1}w_i$ 。</li>
<li>考虑转化题意，可以将题意转化为随机一个排列 $\{a\}$ ，对于点 $i$ ，如果存在 $1\le j<i$ 满足 $a_j$ 是 $a_i$ 的祖先，那么就不会造成贡献，否则造成 $1$ 的贡献，求贡献的期望。发现转化后并不会对答案造成影响，对每个 $i$ 分开算，设 $i$ 的深度为 $d_i$ ， $i$ 及 $i$ 的祖先出现顺序都是等概率的，所以 $i$ 造成贡献的概率就是 $\frac{1}{d_i}$ ，答案就是 $\sum_{i=1}^n\frac{1}{d_i}$ 。</li>
<li>设某个位置 $i(1\le i<n+m)$ 满足 $i$ 和 $i+1$ 分别是“0”和“1” 的概率为 $p$ ，那么 $p=\frac{\frac{(n+m-2)!}{(n-1)!(m-1)!}}{\frac{(n+m)!}{n!m!}}$ ，答案就是 $(n+m-1)p$ 。</li>
<li>设删除的点集为 $S$ ，其中有 $s$ 条边连接的两个端点都被删除了，点 $i$ 的度数为 $d_i$ ，那么连通块数量就是 $1-s+\sum_{i\in S}(d_i-1)$ ，依次考虑每条边和每个点即可。</li>
<li>对于点 $i$ ，设 $p_j$ 表示 $j$ 的 dfs 序小于 $i$ 的概率，那么 $i$ 的期望 dfs 序就是 $\sum p_j$ ，如果 $i=j$ ，那么 $p_j=0$ ，如果 $j$ 是 $i$ 的祖先，那么 $p_j=1$ ，如果 $j$ 是 $i$ 的孩子，那么 $p_j=0$ ，如果上面几种情况都不是，那么考虑遍历到 $i,j$ 的 $\operatorname{lca}$ 的时候，先往 $i$ 方向还是先往 $j$ 方向遍历的概率是一样的，所以 $p_j=\frac{1}{2}$ 。</li>
<li>最大值和最小值本质一样，考虑求最小值，那么 $E(X)=\sum_{i=1}^{\infty}P(X\ge i)=\sum_{i=1}^m(\frac{m-i+1}{m})^n$ 。</li>
</ol>

<h2 id="小结">小结</h2>

概率期望还是挺有意思的，也挺重要的，主要还是要多练，这样才可以运用得更加熟练。

